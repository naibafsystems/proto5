function recargar(){window.location.href=base_url+"hogar"}$(function(){redirectBrowser(),$(window).scroll(function(){$(this).scrollTop()>400?$(".scrollup").fadeIn():$(".scrollup").fadeOut()}),$(".scrollup").on("click",function(){return $("html, body").animate({scrollTop:0},600),!1}),$('[data-tooltip!=""]').qtip({content:{attr:"data-tooltip"},position:{my:"top left"},style:{classes:"qtip-bootstrap qtip-DANE"}});var a=new BootstrapDialog({title:"Instancia del dialogo",message:"Mensaje generico"});$.validator.addMethod("mayor121",function(a,e,o){return!(a>121)}),$.validator.addMethod("totalPersonas",function(a,o,l){return a==e.data().count()});var e=$("#tabla_fallecidas").DataTable({processing:!0,ajax:base_url+"personas/consultarPersonasFallecidas",columns:[{data:"sexo"},{data:"edad"},{data:"certificado"},{data:"opciones"}],language:{url:base_url+"assets/plugins/DataTables/datatables.locale-es.json"},paging:!1,pageLength:100,bFilter:!0,ordering:!0,responsive:!0,searching:!1,info:!1});$("#numero_fallecidas").on("change",function(){$(this).val()>0?$("#grillaFallecidas").removeClass("hidden"):$("#grillaFallecidas").addClass("hidden")}),$("#edad_fallecida").bloquearTexto(),$("#frmHogar").validate({errorClass:"error-form",rules:{sexo_fallecida:{selectVacio:!0},edad_fallecida:{selectVacio:!0,mayor121:!0},certificado_fallecida:{selectVacio:!0}},messages:{sexo_fallecida:{selectVacio:"ERROR: Seleccione el tipo el sexo de la persona fallecida."},edad_fallecida:{selectVacio:"ERROR: Seleccione la edad al morir de la persona fallecida.",mayor121:"ERROR: La edad no debe ser mayor de 121 años."},certificado_fallecida:{selectVacio:"ERROR: Seleccione si se expidió el certificado médico de defunción."}},onfocusout:function(a){$(a).valid()||$("#"+$(a).attr("id")).focus()},errorPlacement:function(a,e){$(e).parents(".form-group").first().append(a.attr("role","alert"))},highlight:function(a,e,o){$(a).parents(".form-group").first().addClass("has-error")},unhighlight:function(a,e,o){$(a).parents(".form-group").first().removeClass("has-error")},submitHandler:function(a){return!0}}),$("#btnGuardarFallecida").on("click",function(){if(1==$("#frmHogar").valid()){var o=$("#frmHogar").serialize(),l=$("#hdnAccion").val(),r=$("#idEditar").val();$.ajax({url:base_url+"personas/persona/guardarFallecida",type:"POST",dataType:"json",data:o+"&accion="+l+"&id="+r,beforeSend:function(){$("#animationload").fadeIn()},complete:function(){$("#animationload").fadeOut()}}).done(function(o){0==o.codiError?(e.ajax.reload(),$("#sexo_fallecida").val(""),$("#edad_fallecida").val(""),$("#certificado_fallecida").val(""),$("#hdnAccion").val("agregar"),$("#idEditar").val(""),$("#btnGuardarFallecida").html("Agregar")):(a.setTitle("Error al guardar la persona fallecida"),a.setType(BootstrapDialog.TYPE_DANGER),a.setMessage(o.mensaje),a.open())}).fail(function(a){window.location.href=base_url+"hogar"})}}),$("#btnLimpiarFallecida").on("click",function(){$(this).parents("form").find("input,select").not("[type=hidden]").val(""),$("#sexo_fallecida").focus(),$("#hdnAccion").val("agregar"),$("#idEditar").val(""),$("#btnGuardarFallecida").html("Agregar")}),$("#tabla_fallecidas").on("click",".editarFallecida",function(){$("#sexo_fallecida").val(""),$("#edad_fallecida").val(""),$("#certificado_fallecida").val("");var e=$(this);$.ajax({url:base_url+"personas/persona/consultarFallecida",type:"POST",dataType:"json",data:{idPers:e.data("idpers")}}).done(function(o){0==o.codiError?($.each(o.form,function(a,e){$("#"+a).val(e)}),$("#sexo_fallecida").focus(),$("#hdnAccion").val("editar"),$("#idEditar").val(e.data("idpers")),$("#btnGuardarFallecida").html("Editar")):(a.setTitle("Error al consultar la persona fallecida"),a.setType(BootstrapDialog.TYPE_DANGER),a.setMessage(o.mensaje),a.open())}).fail(function(a){window.location.href=base_url+"hogar"})}),$("#tabla_fallecidas").on("click",".eliminarFallecida",function(){var o=$(this);BootstrapDialog.show({title:"Borrar persona fallecida",message:"¿Está seguro que quiere borrar a la persona seleccionada?",type:BootstrapDialog.TYPE_WARNING,closable:!1,buttons:[{label:"Cancelar",cssClass:"btn-warning",action:function(a){a.close()}},{label:"Aceptar",cssClass:"btn-success",action:function(l){$.ajax({url:base_url+"personas/persona/eliminarFallecida",type:"POST",dataType:"json",data:{idPers:o.data("idpers")}}).done(function(o){0==o.codiError?(e.ajax.reload(function(a){$("#numero_fallecidas").val(o.total)}),l.close()):(a.setTitle("Error al eliminar la persona fallecida"),a.setType(BootstrapDialog.TYPE_DANGER),a.setMessage(o.mensaje),a.open())}).fail(function(a){window.location.href=base_url+"hogar"})}}]})}),$("#numero_fallecidas").on("click",function(){$(this).val()>0?$("#divFallecidos").removeClass("hidden"):$("#divFallecidos").addClass("hidden")}),$("#btnSiguiente").on("click",function(){var a=$("#frmHogar").validate(),o=$("#numero_fallecidas").val(),l=e.rows(0).data(),r=e.data().count();return 0==l[0].sexo.length&&(r=0),0==o.length?(a.showErrors({numero_fallecidas:"ERROR: Debe seleccionar el número de personas que fallecierón en el 2017."}),!1):o!=r?(a.showErrors({numero_fallecidas:"ERROR: El número de personas fallecidas debe ser igual a las personas de la grilla."}),!1):($("#divContent").addClass("hidden"),$("#total_fallecidas-confirm").html(o),void $("#mensajeConfirmacion").removeClass("hidden"))}),$("#btnAnteriorConfirmacion").on("click",function(){$("#divContent").removeClass("hidden"),$("#mensajeConfirmacion").addClass("hidden")}),$("#btnSiguienteConfirmacion").on("click",function(){var a=$("#numero_fallecidas").val();$(".error-form").addClass("hidden"),$.ajax({url:base_url+"hogar/guardar",type:"POST",dataType:"json",data:"numero_fallecidas="+a+"&duracion="+duracionPagina(),beforeSend:function(){$("#msgSuccessConfirm").html("Guardando las respuestas..."),$("#divMsgConfirm").removeClass("hidden"),$("#divMsgSuccessConfirm").removeClass("hidden")}}).done(function(a){0==a.codiError?($(":input").addClass("disabled").prop("disabled",!0),$(":button").addClass("disabled").prop("disabled",!0),$("#msgSuccessConfirm").html(a.mensaje),$("#divMsgConfirm").removeClass("hidden"),$("#divMsgSuccessConfirm").removeClass("hidden"),$("#progressbar").html(a.avance+"% COMPLETADO").css("width",a.avance+"%"),setTimeout(recargar,2e3)):($("#msgErrorConfirm").html(a.mensaje),$("#divMsgConfirm").removeClass("hidden"),$("#divMsgAlertConfirm").removeClass("hidden"))}).fail(function(a){window.location.href=base_url+"hogar"})}),$("#btnAnterior").on("click",function(){$(":input").addClass("disabled").prop("disabled",!0),$(":button").addClass("disabled").prop("disabled",!0),$.ajax({url:base_url+"hogar/regresar",type:"POST",dataType:"json",data:"duracion="+duracionPagina()}).done(function(a){0==a.codiError?($("#progressbar").html(a.avance+"% COMPLETADO").css("width",a.avance+"%"),window.location.href=base_url+"hogar"):($("#msgError").html(a.mensaje),$("#divMsg").removeClass("hidden"),$("#divMsgAlert").removeClass("hidden"))}).fail(function(a){window.location.href=base_url+"hogar"})})});